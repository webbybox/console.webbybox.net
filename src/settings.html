<wby-layout src="_console_layout.html" />
<wby-set name="page_title" value="Settings" />

<wby-request action="/settings/getConsoleConfig" api="console" method="GET" as="_response" />

<wby-section name="body">
  <h1>Console Settings</h1>

  <wby-form action="/settings/updateConsoleConfig" api="console" method="POST" type="json">
    <!-- Logging -->
    <div class="form-section">
      <h2 class="form-header">Logging</h2>

      <div class="form-group">
        <label class="form-label">Log Level</label>
        <select wby-for="_response.consoleConfig.siteConfig.logging.level" class="form-control form-select" >
            <option value="trace">Trace</option>
            <option value="debug">Debug</option>
            <option value="info">Info</option>
            <option value="warning">Warning</option>
            <option value="error">Error</option>
            <option value="fatal">Fatal</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Log File Path</label>
        <input class="form-control" wby-for="_response.consoleConfig.siteConfig.logging.filepath" />
      </div>

      <div class="form-group">
        <label class="form-label">Max Size (MB)</label>
        <input class="form-control" wby-for="_response.consoleConfig.siteConfig.logging.maxSizeMB" />
      </div>

      <div class="form-group">
        <label class="form-label">Max Backups</label>
        <input class="form-control" wby-for="_response.consoleConfig.siteConfig.logging.maxBackups" />
      </div>

      <div class="form-group">
        <label class="form-label">Max Age (Days)</label>
        <input class="form-control" wby-for="_response.consoleConfig.siteConfig.logging.maxAgeDays" />
      </div>

      <div class="form-group">
        <label class="form-label">Compress</label>
        <input wby-for="_response.consoleConfig.siteConfig.logging.compress" class="form-check-input" type="checkbox" />
      </div>
    </div>

    <!-- Handler Permissions -->
    <div class="form-section">
      <h2 class="form-header">Handler Permissions</h2>

      <div class="form-group">
        <label class="form-label">Service Permission</label>
        <select wby-for="_response.consoleConfig.handlerPermissions.service" class="form-control form-select">
            <option value="local">Local</option>
            <option value="online">Online</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Editor Permission</label>
        <select wby-for="_response.consoleConfig.handlerPermissions.editor" class="form-control form-select" >
            <option value="local">Local</option>
            <option value="online">Online</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Settings Permission</label>
        <select wby-for="_response.consoleConfig.handlerPermissions.settings" class="form-control form-select" >
            <option value="local">Local</option>
            <option value="online">Online</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Connect Permission</label>
        <select wby-for="_response.consoleConfig.handlerPermissions.connect" class="form-control form-select" >
            <option value="local">Local</option>
            <option value="online">Online</option>
        </select>
      </div>
    </div>

    <!-- General Config -->
    <div class="form-section">
      <h2 class="form-header">General Settings</h2>

      <div class="form-group">
        <label class="form-label">Port</label>
        <input wby-for="_response.consoleConfig.siteConfig.port" type="text" class="form-control" />
      </div>

      <div class="form-group">
        <label class="form-label">Source Path</label>
        <input wby-for="_response.consoleConfig.src" type="text" class="form-control" />
      </div>

      <div class="form-group">
        <label class="form-label">JavaScript Challenge</label>
        <input wby-for="_response.consoleConfig.siteConfig.jsChallenge" type="checkbox" class="form-check-input" />
      </div>

      <div class="form-group">
        <label class="form-label">Enable DDNS</label>
        <input wby-for="_response.consoleConfig.ddns" type="checkbox" class="form-check-input" />
      </div>
    </div>

    <!-- Environments -->
    <div class="form-section">
      <h2 class="form-header">Environments</h2>
      <wby-repeat count="{{len(_response.consoleConfig.environments)}}" as="i">
        <div class="env-block">
          <h3>{{_response.consoleConfig.environments[i].name}}</h3>
          <p><strong>Config Path:</strong> {{_response.consoleConfig.environments[i].configPath}}</p>

          <!-- Show the environment's SiteConfig -->
          <div class="nested-section">
            <h4>Logging</h4>
            <div class="form-group">
              <label class="form-label">Log Level</label>
              <select wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.level" class="form-control form-select">
                <option value="trace">Trace</option>
                <option value="debug">Debug</option>
                <option value="info">Info</option>
                <option value="warning">Warning</option>
                <option value="error">Error</option>
                <option value="fatal">Fatal</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Log File Path</label>
              <input class="form-control" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.filepath" />
            </div>

            <div class="form-group">
              <label class="form-label">Max Size (MB)</label>
              <input class="form-control" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.maxSizeMB" />
            </div>

            <div class="form-group">
              <label class="form-label">Max Backups</label>
              <input class="form-control" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.maxBackups" />
            </div>

            <div class="form-group">
              <label class="form-label">Max Age (Days)</label>
              <input class="form-control" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.maxAgeDays" />
            </div>

            <div class="form-group">
              <label class="form-label">Compress</label>
              <input wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.logging.compress" class="form-check-input" type="checkbox" />
            </div>

            <h4>Other Settings</h4>
            <div class="form-group">
              <label class="form-label">Port</label>
              <input class="form-control" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.port" />
            </div>

            <div class="form-group">
              <label class="form-label">JS Challenge</label>
              <input class="form-check-input" type="checkbox" wby-for="_response.envSiteConfigs.{{_response.consoleConfig.environments[i].name}}.jsChallenge" />
            </div>
          </div>
        </div>
        <hr />
      </wby-repeat>
    </div>

    <!-- Submit -->
    <div class="form-group">
      <button class="btn btn-primary" type="submit">Save Settings</button>
    </div>
  </wby-form>
</wby-section>